# Python Project Setup Summary

This document summarizes the changes made to set up the OVRO-LWA Portal as a
proper Python project that can be pip installed.

## Changes Made

### 1. Project Structure

Created the standard Python project structure following the `src/` layout:

```
ovro-lwa-portal/
├── src/
│   └── ovro_lwa_portal/
│       ├── __init__.py
│       └── fits_to_zarr.py
├── tests/
│   ├── __init__.py
│   ├── test_import.py
│   └── test_fits_to_zarr.py
├── pyproject.toml
├── LICENSE
└── INSTALLATION.md
```

### 2. Build Configuration (pyproject.toml)

Created a comprehensive `pyproject.toml` file with:

- **Build system**: Uses `hatchling` with `hatch-vcs` for automatic versioning
  from git tags
- **Project metadata**: Name (`ovro_lwa_portal`), description, authors, license,
  URLs
- **Dependencies**: All required packages from the existing `pixi.toml`
  (astropy, xarray, dask, zarr, netcdf4, numcodecs)
- **Optional dependencies**: Development tools (pytest, pre-commit, etc.)
- **Tool configurations**: pytest, mypy, and ruff settings

### 3. Package Code

#### `src/ovro_lwa_portal/__init__.py`

- Package initialization with docstring
- Version import (auto-generated by hatch-vcs from git tags)
- Exports `fits_to_zarr` module

#### `src/ovro_lwa_portal/fits_to_zarr.py`

Created a module with utilities for FITS to Zarr conversion, based on the
existing Jupyter notebook (`notebooks/fits2zarr.ipynb`):

- `discover_fits_files()`: Find FITS files matching a pattern
- `parse_filename_metadata()`: Extract timestamp and frequency from filenames
- `load_zarr_dataset()`: Load Zarr datasets with xarray

### 4. Tests

Created comprehensive test suite:

- `tests/test_import.py`: Tests package import and version
- `tests/test_fits_to_zarr.py`: Tests for FITS to Zarr utilities
- All tests pass (6/6)
- Tests work without requiring the full dependency stack

### 5. Pixi Configuration Updates

Updated `pixi.toml` to include:

- `hatchling>=1.25.0`: Build backend
- `hatch-vcs>=0.4.0`: Version control system integration
- `pip>=24.0`: For installing the package
- `pytest>=6`: Testing framework
- `pytest-cov>=3.0.0`: Test coverage

### 6. Documentation

#### INSTALLATION.md

Created comprehensive installation guide covering:

- User installation (from GitHub or local)
- Developer setup (with Pixi)
- Testing instructions
- Building the package
- Verification steps

#### README.md Updates

Updated the main README to include:

- Pip installation instructions for users
- Reference to detailed INSTALLATION.md
- Clear separation between user and developer workflows

### 7. License

Added BSD 3-Clause license file (was missing from the repository).

### 8. Git Configuration

Updated `.gitignore` to exclude:

- `src/*/version.py` (auto-generated by hatch-vcs)

## Installation and Usage

### For Users

```bash
pip install git+https://github.com/uw-ssec/ovro-lwa-portal.git
```

### For Developers

```bash
# Clone and setup
git clone https://github.com/uw-ssec/ovro-lwa-portal.git
cd ovro-lwa-portal
pixi install

# Run tests
pixi run pytest tests/

# Or with Python directly
pytest tests/
```

### Verifying Installation

```python
import ovro_lwa_portal
print(ovro_lwa_portal.__version__)

# Use FITS to Zarr utilities
from ovro_lwa_portal import fits_to_zarr
fits_files = fits_to_zarr.discover_fits_files("data/*.fits")
```

## Package Features

The package now:

1. ✅ Can be pip installed
2. ✅ Has proper versioning from git tags (via hatch-vcs)
3. ✅ Follows modern Python packaging standards (PEP 517/518)
4. ✅ Uses the `src/` layout for better isolation
5. ✅ Has a comprehensive test suite
6. ✅ Includes development dependencies
7. ✅ Has proper metadata for PyPI (classifiers, URLs, etc.)
8. ✅ Works with both Pixi and standard Python workflows

## Next Steps

1. **Add more modules**: Expand functionality based on the notebooks
2. **CI/CD**: Set up GitHub Actions for testing and building
3. **Documentation**: Add Sphinx documentation
4. **Publishing**: Consider publishing to PyPI
5. **Version management**: Create git tags for releases (e.g., `v0.1.0`)

## Notes

- The version file (`src/ovro_lwa_portal/version.py`) is auto-generated by
  hatch-vcs from git tags and should not be committed
- Pre-commit checks may require network access for some hooks
- The package requires Python 3.12+ to match the Pixi environment
